{% extends "index.html" %}
{% load static %}

{% block head_extra %}
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    .dashboard-header {
      padding: 20px 0;
      margin-bottom: 30px;
    }
    
    .dashboard-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #344767;
      margin-bottom: 10px;
    }
    
    .dashboard-subtitle {
      font-size: 1rem;
      color: #67748e;
    }
    
.kpi-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

    
    .kpi-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .kpi-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    }
    
    .kpi-card.primary {
      border-left: 4px solid #5e72e4;
    }
    
    .kpi-card.success {
      border-left: 4px solid #2dce89;
    }
    
    .kpi-card.warning {
      border-left: 4px solid #fb6340;
    }
    
    .kpi-card.info {
      border-left: 4px solid #11cdef;
    }
    
    .kpi-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .kpi-title {
      color: #67748e;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .kpi-icon {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    
    .chart-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .chart-container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      padding: 15px;
      transition: all 0.3s ease;
    }
    
    .chart-container:hover {
      box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    }
    
    .chart-full {
      grid-column: 1 / -1;
    }
    
    @media (max-width: 992px) {
      .chart-row {
        grid-template-columns: 1fr;
      }
      
      .kpi-container {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }
    
    /* Styl dla tabeli rezerwacji */
    .table-responsive {
      overflow-x: auto;
    }
    
    .table {
      width: 100%;
      margin-bottom: 1rem;
      color: #67748e;
      border-collapse: separate;
      border-spacing: 0 8px;
    }
    
    .table thead th {
      padding: 12px 16px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid #e9ecef;
    }
    
    .table tbody tr {
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.02);
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    
    .table tbody tr:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      transform: translateY(-2px);
    }
    
    .table tbody td {
      padding: 16px;
      vertical-align: middle;
      border-top: 0;
    }
    
    .table tbody tr td:first-child {
      border-top-left-radius: 8px;
      border-bottom-left-radius: 8px;
    }
    
    .table tbody tr td:last-child {
      border-top-right-radius: 8px;
      border-bottom-right-radius: 8px;
    }
    
    {#.badge {#}
    {#  padding: 6px 10px;#}
    {#  font-size: 0.75rem;#}
    {#  font-weight: 600;#}
    {#  border-radius: 6px;#}
    {#}#}
    {##}
    {#.badge.bg-success {#}
    {#  background-color: #2dce89 !important;#}
    {#}#}
    {##}
    {#.badge.bg-secondary {#}
    {#  background-color: #8898aa !important;#}
    {#}#}
    {##}
    {#.btn-outline-primary {#}
    {#  color: #5e72e4;#}
    {#  border-color: #5e72e4;#}
    {#}#}
    {##}
    {#.btn-outline-primary:hover {#}
    {#  background-color: #5e72e4;#}
    {#  color: white;#}
    {#}#}

  </style>
{% endblock %}

{% block content %}
  <div class="container-fluid py-4 px-5">
    <div class="dashboard-header">
      <h1 class="dashboard-title">Resource Dashboard</h1>
{#      <p class="dashboard-subtitle">Overview of all bookings and resource utilization</p>#}
    </div>
    

  <div class="kpi-container" style="margin-top: 30px; margin-bottom: 30px;">
  <div class="kpi-card primary" style="display: flex; gap: 40px; justify-content: space-around; align-items: center; flex-wrap: wrap;">
    <span><i class="fas fa-calendar-check"></i> Total: {{ total_reservations }}</span>
    <span><i class="fas fa-business-time"></i> Active: {{ active_reservations }}</span>
    <span><i class="fas fa-clipboard-list"></i> Resources: {{ total_resources }}</span>
    <span><i class="fas fa-chart-pie"></i> Rate: {{ utilization_rate }}%</span>
  </div>
</div>

    <!-- Charts - First Row -->
    <div class="chart-row">
      <div class="chart-container">
        {{ plot_div1|safe }}
      </div>
      
      <div class="chart-container">
        {{ plot_div2|safe }}
      </div>
    </div>
    
    <!-- Charts - Second Row -->
    <div class="chart-row">
      <div class="chart-container chart-full">
        {{ plot_div3|safe }}
      </div>
    </div>
    
{#    <!-- Recent Reservations Table -->#}
{#    <div class="row mt-4">#}
{#      <div class="col-12">#}
{#        <div class="card border shadow-xs mb-4">#}
{#          <div class="card-header border-bottom pb-0">#}
{#            <div class="d-sm-flex align-items-center">#}
{#              <div>#}
{#                <h6 class="font-weight-semibold text-lg mb-0">Your Recent Reservations</h6>#}
{#                <p class="text-sm mb-sm-0 mb-2">Overview of your latest bookings</p>#}
{#              </div>#}
{#              <div class="ms-auto d-flex">#}
{#                <a href="{% url 'reserve' %}" class="btn btn-sm btn-primary mb-0 ms-2">#}
{#                  <i class="fas fa-plus me-2"></i>New Reservation#}
{#                </a>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
{#          #}
{#          <div class="card-body px-0 py-0">#}
{#            <div class="table-responsive p-0">#}
{#              <table class="table align-items-center mb-0">#}
{#                <thead class="bg-gray-100">#}
{#                  <tr>#}
{#                    <th class="text-secondary text-xs font-weight-semibold opacity-7">Type</th>#}
{#                    <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2">Name</th>#}
{#                    <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">Date Range</th>#}
{#                    <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">Status</th>#}
{#                    <th class="text-secondary opacity-7"></th>#}
{#                  </tr>#}
{#                </thead>#}
{#                <tbody>#}
{#                  {% if recent_reservations %}#}
{#                    {% for reservation in recent_reservations %}#}
{#                      <tr>#}
{#                        <td class="text-sm font-weight-semibold">{{ reservation.type }}</td>#}
{#                        <td class="text-sm">#}
{#                          {% if reservation.type == 'DESK' %}#}
{#                            {{ reservation.desk.name }} #{{ reservation.desk.number }}#}
{#                          {% elif reservation.type == 'ROOM' %}#}
{#                            {{ reservation.room.name }} #{{ reservation.room.number }}#}
{#                          {% elif reservation.type == 'PARKING' %}#}
{#                            Parking #{{ reservation.parking.number }}#}
{#                          {% endif %}#}
{#                        </td>#}
{#                        <td class="text-center text-sm">{{ reservation.start_date }} - {{ reservation.end_date }}</td>#}
{#                        <td class="text-center">#}
{#                          {% now "Y-m-d" as today_date %}#}
{#                          {% if reservation.end_date|date:"Y-m-d" >= today_date %}#}
{#                            <span class="badge bg-success">Active</span>#}
{#                          {% else %}#}
{#                            <span class="badge bg-secondary">Expired</span>#}
{#                          {% endif %}#}
{#                        </td>#}
{#                        <td class="text-center">#}
{#                          <a href="#" class="btn btn-sm btn-outline-primary">Details</a>#}
{#                        </td>#}
{#                      </tr>#}
{#                    {% endfor %}#}
{#                  {% else %}#}
{#                    <tr>#}
{#                      <td colspan="5" class="text-center py-4 text-secondary">#}
{#                        You don't have any recent reservations#}
{#                      </td>#}
{#                    </tr>#}
{#                  {% endif %}#}
{#                </tbody>#}
{#              </table>#}
{#            </div>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{#    #}
{#    <!-- Action Buttons -->#}
{#    <div class="row mt-4 mb-5">#}
{#      <div class="col-12 text-center">#}
{#        <a href="{% url 'reserve' %}" class="btn btn-lg btn-primary me-3">#}
{#          <i class="fas fa-plus me-2"></i>Make Reservation#}
{#        </a>#}
{#        <a href="{% url 'index' %}" class="btn btn-lg btn-outline-secondary">#}
{#          <i class="fas fa-home me-2"></i>Back to Home#}
{#        </a>#}
{#      </div>#}
{#    </div>#}
{#  </div>#}
{% endblock %}